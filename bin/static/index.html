<!DOCTYPE html>
<head>
<title>Authorization</title>
<meta charset="UTF-8">

<link href="favicon.ico"
      rel="shortcut icon"/>

<link rel="stylesheet"
      href="chugun.css"
      type="text/css"
      media="screen"
      charset="utf-8"/>
    
<script type="text/javascript" src="jquery.js"></script>
<script type = "text/javascript" src="tests.js"></script>
</head>

<body>
<div id="left-sidebar">
    <div class="navigation">
        <h1>Authorization</h1>
    </div>
</div>

<div id="content">
    <form id="formregister">
        <div class="formrow">
            <label for="username">Login</label>
            <input type="text" id="username" name="login"/>
        </div>          

        <div class="formrow">
            <label for="password">Password</label>
            <input type="password" id="password" name="password"/>
        </div>              

        <input type="button" value="register" id="register" name="submit"/>
        <input type="button" value="login" id="login" name="submit"/>
        <input type="button" value="test" id="test" name="submit"/>
    </form>
	<form id="formexit" >
		<input type="button" id="logout" value="Exit" name="submit" style="visibility: hidden"/> 
	</form>
</div>

<script type="text/javascript">
    function json(action){
        var js = {
            "action": action,
            "login": $("#username").val(),
            "password": $("#password").val(),
        }
        $.ajax({
            type: "post",
            dataType: "json", 
            url: location.href,
            data: JSON.stringify(js),
            ContentType: "application/json; charset=utf-8",
            success:  function (data){
                $("#formregister").hide();
                var items = [];
                $.each(data, function(key, val){
                    items.push("<li>" + key + " " + val + "</li>");
					if (val=="ok") {
						var obBut = document.getElementById("logout");
						obBut.style.visibility = "visible"; 
					}
                });
                $("<ul/>", {
                    html: items.join("")
                }).appendTo("#content");
            },
            error: function (ajaxRequest, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    }
	function Exit() {
		var js = {
            "action": "logout",
        }
		$.ajax({
            type: "post",
            dataType: "json", 
            url: location.href,
            data: JSON.stringify(js),
            ContentType: "application/json; charset=utf-8",
            success:  function (data){
				$("#formexit").hide();
                var items = [];
                $.each(data, function(key, val){
                    items.push("<li>" + key + " " + val + "</li>");
                });
                $("<ul/>", {
                    html: items.join("")
                }).appendTo("#content");
            }
        });
	}
    $("#register").click(function(){
        json("register");
    });
    $("#login").click(function(){
        json("login");
    });
    $("#test").click(function(){
        runTests();
    });
	$("#logout").click(function(){
        Exit();
    });
</script>

<footer id="footer">
</footer>

</body> 

</html>